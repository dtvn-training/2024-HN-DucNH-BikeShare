import{h as he,V as P,i as re,f as we,a as ae,_ as Ce}from"./VSnackbar-BrgTQRVT.js";import{p as De,E as Ie,h as Ne,y as Te,b as c,r as u,G as ke,e as de,j as Me,l as a,F as W,z as Se,g as me,H as Ue,I as Ee,A as Fe,B as i,w as d,C as ce,o as oe,a as B,D as G,c as ve,J as Ae}from"./index-Bf1LuIpX.js";import{p as Be,q as Pe,d as S,r as le,e as Re,g as $e,h as Le,i as ue,A as ze,l as pe,n as Oe,M as fe,o as je,k as _e}from"./VRadioGroup-c5Oqobg7.js";const qe=De({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,modelValue:{type:Number,default:null},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},step:{type:Number,default:1},...Ie(Be({}),["appendInnerIcon","modelValue","prependInnerIcon"])},"VNumberInput"),be=Ne()({name:"VNumberInput",props:{...qe()},emits:{"update:modelValue":o=>!0},setup(o,ne){let{slots:m}=ne;const h=Te(o,"modelValue"),s=c({get:()=>h.value,set(l){if(l===null){h.value=null;return}!isNaN(+l)&&+l<=o.max&&+l>=o.min&&(h.value=+l)}}),v=u(),D=c(()=>me(o.step)),I=c(()=>typeof s.value=="number"?me(s.value):0),_=Pe(),b=c(()=>o.disabled||o.readonly||(_==null?void 0:_.isReadonly.value)),g=c(()=>b.value?!1:(s.value??0)+o.step<=o.max),k=c(()=>b.value?!1:(s.value??0)-o.step>=o.min),r=c(()=>o.hideInput?"stacked":o.controlVariant),w=c(()=>r.value==="split"?"$plus":"$collapse"),R=c(()=>r.value==="split"?"$minus":"$expand"),V=c(()=>r.value==="split"?"default":"small"),N=c(()=>r.value==="stacked"?"auto":"100%"),K=c(()=>({click:ee})),Z=c(()=>({click:H}));ke(()=>{!o.readonly&&!o.disabled&&p()});function U(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(b.value)return;if(s.value==null){s.value=de(0,o.min,o.max);return}const C=Math.max(I.value,D.value);l?g.value&&(s.value=+(s.value+o.step).toFixed(C)):k.value&&(s.value=+(s.value-o.step).toFixed(C))}function ee(l){l.stopPropagation(),U()}function H(l){l.stopPropagation(),U(!1)}function te(l){var z,F,Q;if(!l.data)return;const C=(z=l.target)==null?void 0:z.value,$=(F=l.target)==null?void 0:F.selectionStart,J=(Q=l.target)==null?void 0:Q.selectionEnd,L=C?C.slice(0,$)+l.data+C.slice(J):l.data;/^-?(\d+(\.\d*)?|(\.\d+)|\d*|\.)$/.test(L)||l.preventDefault()}async function E(l){["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(l.key)||l.ctrlKey||["ArrowDown","ArrowUp"].includes(l.key)&&(l.preventDefault(),p(),await Ue(),l.key==="ArrowDown"?U(!1):U())}function y(l){l.stopPropagation()}function p(){if(!v.value)return;const l=v.value.value;l&&!isNaN(+l)?s.value=de(+l,o.min,o.max):s.value=null}return Me(()=>{const{modelValue:l,...C}=S.filterProps(o);function $(){return m.increment?a(re,{key:"increment-defaults",defaults:{VBtn:{disabled:!g.value,flat:!0,height:N.value,size:V.value,icon:w.value}}},{default:()=>[m.increment(K.value)]}):a(P,{disabled:!g.value,flat:!0,key:"increment-btn",height:N.value,name:"increment-btn",icon:w.value,onClick:ee,onMousedown:y,size:V.value,tabindex:"-1"},null)}function J(){return m.decrement?a(re,{key:"decrement-defaults",defaults:{VBtn:{disabled:!k.value,flat:!0,height:N.value,size:V.value,icon:R.value}}},{default:()=>[m.decrement(Z.value)]}):a(P,{disabled:!k.value,flat:!0,key:"decrement-btn",height:N.value,name:"decrement-btn",icon:R.value,size:V.value,tabindex:"-1",onClick:H,onMousedown:y},null)}function L(){return a("div",{class:"v-number-input__control"},[J(),a(le,{vertical:r.value!=="stacked"},null),$()])}function z(){return!o.hideInput&&!o.inset?a(le,{vertical:!0},null):void 0}const F=r.value==="split"?a("div",{class:"v-number-input__control"},[a(le,{vertical:!0},null),$()]):o.reverse?void 0:a(W,null,[z(),L()]),Q=m["append-inner"]||F,O=r.value==="split"?a("div",{class:"v-number-input__control"},[J(),a(le,{vertical:!0},null)]):o.reverse?a(W,null,[L(),z()]):void 0,X=m["prepend-inner"]||O;return a(S,Se({ref:v,modelValue:s.value,"onUpdate:modelValue":T=>s.value=T,onBeforeinput:te,onChange:p,onKeydown:E,class:["v-number-input",{"v-number-input--default":r.value==="default","v-number-input--hide-input":o.hideInput,"v-number-input--inset":o.inset,"v-number-input--reverse":o.reverse,"v-number-input--split":r.value==="split","v-number-input--stacked":r.value==="stacked"},o.class]},C,{style:o.style,inputmode:"decimal"}),{...m,"append-inner":Q?function(){var q;for(var T=arguments.length,j=new Array(T),x=0;x<T;x++)j[x]=arguments[x];return a(W,null,[(q=m["append-inner"])==null?void 0:q.call(m,...j),F])}:void 0,"prepend-inner":X?function(){var q;for(var T=arguments.length,j=new Array(T),x=0;x<T;x++)j[x]=arguments[x];return a(W,null,[O,(q=m["prepend-inner"])==null?void 0:q.call(m,...j)])}:void 0})}),he({},v)}}),Ge={class:"container"},Ke={class:"col w-1"},He={class:"search-content"},Je={class:"search-section"},Qe={class:"flex"},Xe={class:"center"},Ye={class:"col w-2"},We={class:"table-content"},Ze={class:"table-header"},et={class:"button-group"},tt=["onClick"],at=["onClick"],lt={class:"center"},nt={class:"center"},ot={class:"flex"},Y=400,ge=2e3,rt={__name:"Trips",setup(o){const ne=Ae(),m=[{title:"Trip ID",key:"trip_id",sortable:!1},{title:"Subscriber type",key:"subscriber_type",sortable:!1},{title:"Bike ID",key:"bike_id",sortable:!1},{title:"Bike type",key:"bike_type",sortable:!1},{title:"Start time (UTC)",key:"start_time",sortable:!1},{title:"Start station",key:"start_station_name",sortable:!1},{title:"End station",key:"end_station_name",sortable:!1},{title:"Duration (minutes)",key:"duration_minutes",sortable:!1}],h=u(),s=u(""),v=u(""),D=u(""),I=u(""),_=u(""),b=u(""),g=u(0),k=u(0),r=u(""),w=u(""),R=u(0),V=u(!1),N=u(!0),K=u(!1),Z=u(),U=u(ge),ee=u(),H=u(!1),te=u([]),E=u({start_station_name:"",end_station_name:"",distance:0}),y=u({latitude:0,longitude:0}),p=u({latitude:0,longitude:0}),l=u(0);function C(n){return n.toISOString().slice(0,19).replace("T"," ")}function $(n){return n.replace("/"," & ")}function J(){s.value="",v.value="",D.value="",I.value="",_.value="",b.value="",g.value=0,k.value=0,r.value="",w.value=""}function L(n,e){if(console.log(n),te.value.forEach(t=>{if(!n.localeCompare(t.name)||!$(n).localeCompare(t.name)){const[M,A]=t.location.replace("(","").replace(")","").split(",").map(f=>parseFloat(f));y.value={latitude:M,longitude:A},console.log(y.value)}if(!e.localeCompare(t.name)||!$(e).localeCompare(t.name)){const[M,A]=t.location.replace("(","").replace(")","").split(",").map(f=>parseFloat(f));p.value={latitude:M,longitude:A},console.log(p.value)}}),y.value.latitude!==0&&p.value.latitude!==0){const t=Q(y.value.latitude,y.value.longitude,p.value.latitude,p.value.longitude);console.log(Math.round(t*100)/100),l.value=Math.round(t*100)/100,E.value={start_station_name:n,end_station_name:e,distance:l.value},V.value=!0}else console.log("Not found");V.value=!0}function z(){V.value=!1,F()}Ee(()=>V.value,n=>{n||F()});function F(){E.value={start_station_name:"",end_station_name:"",distance:0},y.value={latitude:0,longitude:0},p.value={latitude:0,longitude:0},l.value=0}function Q(n,e,t,M){var A=6371,f=O(t-n),ie=O(M-e),se=Math.sin(f/2)*Math.sin(f/2)+Math.cos(O(n))*Math.cos(O(t))*Math.sin(ie/2)*Math.sin(ie/2),ye=2*Math.atan2(Math.sqrt(se),Math.sqrt(1-se)),xe=A*ye;return xe}function O(n){return n*(Math.PI/180)}function X(n){Z.value=n,K.value=!0}function T(){const n={limit:0,offset:0,trip_id:s.value,subscriber_type:v.value,bike_id:D.value,bike_type:I.value,start_station_name:_.value,end_station_name:b.value,min_duration:g.value,max_duration:k.value,min_start_time:r.value,max_start_time:w.value},e=ne.resolve({name:"Charts",query:n});window.open(e.href,"_blank")}async function j(){await ae.post("/stations",{name:"",address:"",status:"",property_type:"",power_type:"",min_docks:0,max_docks:0,min_length:0,max_length:0,min_width:0,max_width:0}).then(n=>{te.value=n.data.stations}).catch(n=>{console.log(n)})}ke(()=>{j()});async function x(){R.value=0,X("Querying..."),await ae.post("/trips",{limit:Y,offset:R.value,trip_id:s.value,subscriber_type:v.value,bike_id:D.value,bike_type:I.value,start_station_name:_.value,end_station_name:b.value,min_duration:g.value,max_duration:k.value,min_start_time:r.value,max_start_time:w.value}).then(n=>{h.value=n.data.trips,ee.value=JSON.stringify(n.data),X("Query completed"),h.value.length%Y!=0||h.value.length==0?N.value=!0:N.value=!1}).catch(n=>{console.log(n)})}async function q(){R.value+=Y,await ae.post("/trips",{limit:Y,offset:R.value,trip_id:s.value,subscriber_type:v.value,bike_id:D.value,bike_type:I.value,start_station_name:_.value,end_station_name:b.value,min_duration:g.value,max_duration:k.value,min_start_time:r.value,max_start_time:w.value}).then(n=>{n.data.trips.forEach(e=>{h.value.push(e)}),h.value.length%Y!=0&&(N.value=!0),X("Loaded more rows")})}async function Ve(){U.value=3e5,X("Exporting..."),H.value=!0;try{const n=await ae.post("/export/trips/getAll",{limit:0,offset:0,trip_id:s.value,subscriber_type:v.value,bike_id:D.value,bike_type:I.value,start_station_name:_.value,end_station_name:b.value,min_duration:g.value,max_duration:k.value,min_start_time:r.value,max_start_time:w.value},{responseType:"blob",headers:{"Content-Type":"application/json"}}),e=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=new Date,M=`Trips_${t.getFullYear()}_${t.getMonth()+1}_${t.getDate()}_${t.getHours()}_${t.getMinutes()}_${t.getSeconds()}.xlsx`,A=window.URL.createObjectURL(e),f=document.createElement("a");f.href=A,f.setAttribute("download",M),document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(A),document.body.removeChild(f),U.value=ge,K.value=!1,H.value=!1}catch(n){console.error("Download failed:",n)}}return window.onbeforeunload=function(){return""},(n,e)=>(oe(),Fe(W,null,[a(Ce),i("div",Ge,[i("div",Ke,[i("div",He,[e[18]||(e[18]=i("div",null,[i("h3",{class:"title"},"Search")],-1)),i("div",Je,[a(S,{label:"Trip ID","control-variant":"stacked",modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value=t)},null,8,["modelValue"]),a(S,{label:"Subscriber type",modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t)},null,8,["modelValue"]),a(Re,{inline:"",label:"Bike type",modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=t=>I.value=t)},{default:d(()=>[a(ue,{label:"Any",value:""}),a(ue,{label:"Classic",value:"classic"}),a(ue,{label:"Electric",value:"electric"})]),_:1},8,["modelValue"]),a(S,{label:"Bike ID","control-variant":"stacked",modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=t=>D.value=t)},null,8,["modelValue"]),a(S,{label:"Start station",modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=t=>_.value=t)},null,8,["modelValue"]),a(S,{label:"End station",modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=t=>b.value=t)},null,8,["modelValue"]),e[13]||(e[13]=i("p",null,"Duration (in minutes)",-1)),i("div",Qe,[a(ce(be),{label:"","control-variant":"stacked","max-width":"150",min:0,modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value=t)},null,8,["modelValue"]),e[12]||(e[12]=i("p",{style:{margin:"auto"}},"to",-1)),a(ce(be),{label:"","control-variant":"stacked","max-width":"150",min:0,modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=t=>k.value=t)},null,8,["modelValue"])]),e[14]||(e[14]=i("p",null,"Session start time from",-1)),a(S,{type:"datetime-local",modelValue:r.value,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value=t)},null,8,["modelValue"]),e[15]||(e[15]=i("p",null,"to",-1)),a(S,{type:"datetime-local",modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=t=>w.value=t)},null,8,["modelValue"])]),i("div",Xe,[a(P,{variant:"tonal",class:"btn",onClick:J},{default:d(()=>e[16]||(e[16]=[B("Reset")])),_:1}),a(P,{variant:"outlined",class:"btn",onClick:x},{default:d(()=>e[17]||(e[17]=[B("Search")])),_:1})])])]),i("div",Ye,[i("div",We,[i("div",Ze,[i("div",et,[a(P,{variant:"outlined",class:"btn",onClick:T},{default:d(()=>e[19]||(e[19]=[B("Charts")])),_:1}),a(P,{variant:"outlined",class:"btn",onClick:Ve,disabled:H.value},{default:d(()=>e[20]||(e[20]=[B("Export")])),_:1},8,["disabled"])])]),a($e,{headers:m,items:h.value},{"item.start_station_name":d(({item:t})=>[i("div",null,[i("p",{onClick:M=>L(t.start_station_name,t.end_station_name),class:"address"},G(t.start_station_name),9,tt)])]),"item.start_time":d(({item:t})=>[i("div",null,G(C(new Date(t.start_time))),1)]),"item.end_station_name":d(({item:t})=>[i("div",null,[i("p",{onClick:M=>L(t.start_station_name,t.end_station_name),class:"address"},G(t.end_station_name),9,at)])]),_:1},8,["items"]),a(P,{variant:"outlined",class:"btn",onClick:q,disabled:N.value},{default:d(()=>e[21]||(e[21]=[B("Load more")])),_:1},8,["disabled"])])])]),a(ze),a(we,{modelValue:K.value,"onUpdate:modelValue":e[10]||(e[10]=t=>K.value=t),timeout:U.value},{default:d(()=>[B(G(Z.value),1)]),_:1},8,["modelValue","timeout"]),a(Le,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=t=>V.value=t),"max-width":"1400"},{default:d(()=>[E.value.start_station_name.localeCompare("")?(oe(),ve(_e,{key:0},{default:d(()=>[a(pe,null,{default:d(()=>[i("p",lt,G(E.value.start_station_name)+" to "+G(E.value.end_station_name),1)]),_:1}),a(Oe,null,{default:d(()=>[i("p",nt,"Distance: "+G(E.value.distance)+" km",1)]),_:1}),i("div",ot,[a(fe,{latitude:y.value.latitude,longitude:y.value.longitude,class:"map"},null,8,["latitude","longitude"]),a(fe,{latitude:p.value.latitude,longitude:p.value.longitude},null,8,["latitude","longitude"])]),a(je,null,{default:d(()=>[a(P,{color:"blue darken-1",text:"",onClick:z},{default:d(()=>e[22]||(e[22]=[B("Close")])),_:1})]),_:1})]),_:1})):(oe(),ve(_e,{key:1},{default:d(()=>[a(pe,null,{default:d(()=>e[23]||(e[23]=[B("Not enough information")])),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}};export{rt as default};
